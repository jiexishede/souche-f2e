Souche.UI.CustomDropdown=function(){var e=function(e){this.id=e,this.ele=typeof e!="string"?$(e):$("#"+this.id),this.init()};return e.prototype={init:function(){function n(){var n=$(".sc-option-list",e.ele);t?($(".sc-option-list").addClass("hidden"),$(".sc-option-list",e.ele).removeClass("hidden"),n.css({top:25}),$(n[0].parentNode).css({zIndex:Souche.Data.DropdownzIndex++})):($(".sc-option-list").addClass("hidden"),n.css({top:25}))}var e=this,t=0;$(document.body).click(function(t){$(t.target).closest(".sc-option").length||($(".sc-option-list",e.ele).addClass("hidden"),$(".sc-option-list").css({top:25}))}),$(".sc-option-hd",this.ele).click(function(t){var n=$(".sc-option-list",e.ele);$(".sc-option-list",e.ele).hasClass("hidden")?($(".sc-option-list").addClass("hidden"),$(".sc-option-list",e.ele).removeClass("hidden"),n.css({top:25}),$(n[0].parentNode).css({zIndex:Souche.Data.DropdownzIndex++})):($(".sc-option-list").addClass("hidden"),n.css({top:25}))}),$(".sc-option-list li",this.ele).length>10&&$(".sc-option-list",this.ele).css("height",300);var r,i;$(this.ele).mouseenter(function(){t=1,clearTimeout(r),clearTimeout(i),r=setTimeout(function(){n()},1e3)}).mouseleave(function(){t=0,clearTimeout(r),clearTimeout(i),i=setTimeout(function(){n()},500)})}},e}(),define("souche/dropdown",[],function(){return Souche.UI.CustomDropdown}),define("souche/util/num-animate",[],function(){return{animateInnerHTML:function(e,t){var n=e.html(),r=n.replace(/[^-0-9]/g,""),i=t.replace(/[^-0-9]/g,"");r!==""&&i!==""?(r*=1,i*=1,r-i>50||r-i<-50?e.html(t):r<i?setTimeout(function(){r<i&&(r++,e.html(n.replace(/[-0-9]+/g,r)),setTimeout(arguments.callee,10))},10):setTimeout(function(){r>i&&(r--,e.html(n.replace(/[-0-9]+/g,r)),setTimeout(arguments.callee,10))},10)):e.html(t)},animateValue:function(e,t){}}}),define("souche/custom-select",["souche/util/num-animate"],function(e){return Souche.UI.CustomSelect=function(){var t=function(e,t){this.id=e,this.ele=typeof e!="string"?$(e):$("#"+this.id),this.config={isAutoDrop:!0,placeholder:"请选择品牌",multi:!0,listContainer:".sc-select-list .sc-popup-bd"},$.extend(this.config,t),this.selected=[],this.config.onchange&&$(this).on("change",this.config.onchange),this._init(),this._defaultHeadHeight=30,this._enable=!0};return $.extend(t.prototype,{addOptions:function(e){$(this.config.listContainer,this.ele).append(e);for(var t=0;t<this.selected.length;t++)$(".sc-select-list .option[data-value='"+this.selected[t].key+"']").addClass("active")},setSelected:function(e){this.config.multi?this.selected.push({key:e,value:e}):this.selected=[{key:e,value:e}],$(self).trigger("change",{key:e,value:e}),this._renderSelected()},removeSelected:function(e){this._delKey(e),this._renderSelected()},removeAllOption:function(){$(this.config.listContainer,this.ele).html("")},showOptions:function(){if(!this._enable)return;$(".sc-select-list",this.ele).removeClass("hidden"),this.ele.addClass("sc-active"),$(this).trigger("show")},hideOptions:function(){$(".sc-select-list",this.ele).addClass("hidden"),this.ele.removeClass("sc-active"),$(this).trigger("hide")},disable:function(e){$(".sc-select-content",this.ele).html("<span class='placeholder'>"+e+"</span>"),this._enable=!1},enable:function(e){this._enable=!0,this._renderSelected()}}),$.extend(t.prototype,{_init:function(e){var t=this;Souche.Util.mixin(this.config,e),this._defaultHeadHeight=$(".sc-select-hd").height(),$(".sc-selected-item",t.ele).each(function(e,n){t.selected.push({key:$(n).attr("data-value"),value:$(n).text().replace("x","")})}),this.config.multi||$(".selected_values",t.ele).val()&&(t.selected=[{key:$(".selected_values",t.ele).val(),value:$(".selected_values",t.ele).val()}]),$(document.body).on("click",function(e){$(e.target).closest(".sc-select").length||t.hideOptions()}),this._bindClick(),this._bindSelect(),this.config.multi?this._renderSelected():this._renderSingleSelected()},_bindClick:function(){function n(){var n=$(".sc-select-list",e.ele);t?($(".sc-select-list").addClass("hidden"),e.showOptions(),$(".sc-select-list",e.ele).css({top:$(".sc-select-hd",e.ele).height()+2}),e.config.isAutoDrop&&e._autoDrop(n),$(".sc-select-list",e.ele).scrollTop(0),$(n[0].parentNode).css({zIndex:Souche.Data.DropdownzIndex++})):(e.hideOptions(),n.css({top:30}))}var e=this,t=0;$(".sc-select-hd",this.ele).click(function(t){var n=$(".sc-select-list",e.ele);$(".sc-select-list",e.ele).hasClass("hidden")?($(".sc-select-list").addClass("hidden"),e.showOptions(),$(".sc-select-list",e.ele).css({top:$(".sc-select-hd",e.ele).height()+2}),e.config.isAutoDrop&&e._autoDrop(n),$(".sc-select-list",e.ele).scrollTop(0),$(n[0].parentNode).css({zIndex:Souche.Data.DropdownzIndex++})):(e.hideOptions(),n.css({top:30}))});var r,i;$(this.ele).mouseenter(function(){t=1,clearTimeout(r),clearTimeout(i),r=setTimeout(function(){n()},1e3)}).mouseleave(function(){t=0,clearTimeout(i),clearTimeout(r),i=setTimeout(function(){n()},500)})},_bindSelect:function(){var e=this;$(".sc-select-list",e.ele).on("click","a.option",function(t){t.preventDefault();var n=$(this).attr("data-value"),r=$(".value",this).html(),i=$(this);e.config.multi?(i.hasClass("active")?(e._delKey(n),i.removeClass("active"),$(e).trigger("unselect",{key:n,value:r})):(e._addKey(n,r),i.addClass("active"),$(e).trigger("select",{key:n,value:r})),e._renderSelected()):(e.selected=[{key:n,value:r}],e._renderSingleSelected()),$(e).trigger("change",{key:n,value:r}),t.stopPropagation()}),$(".sc-select-list",e.ele).on("click",function(e){e.stopPropagation()}),$(".close",e.ele).on("click",function(t){e.hideOptions()}),$(".sc-select-list",e.ele).on("scroll",function(e){e.stopPropagation()})},_delKey:function(e){var t=this;for(var n=0;n<t.selected.length;n++){var r=t.selected[n];r&&r.key==e&&t.selected.splice(n,1)}},_addKey:function(e,t){var n=this,r=!1;for(var i=0;i<n.selected.length;i++){var s=n.selected[i];s&&s.key==e&&(r=!0)}r||n.selected.push({key:e,value:t})},_renderSelected:function(){var e=this,t=[];for(var n=0;n<e.selected.length;n++)t.push(e.selected[n].key);$(".selected_values",e.ele).val(t.join(",")),$(".sc-select-content",e.ele).html("");for(var n=0;n<e.selected.length;n++){var t=e.selected[n];$(".sc-select-content",e.ele).append("<div class=sc-selected-item data-value='"+t.key+"'>"+t.value+"<i class=sc-close>x</i></div>")}$(".sc-selected-item",e.ele).on("click",function(t){var n=$(this).attr("data-value");for(var r=0;r<e.selected.length;r++){var i=e.selected[r];i&&i.key==n&&e.selected.splice(r,1)}$(e).trigger("unselect",{key:n}),e._renderSelected(),$(".sc-select-list a.option[data-value='"+n+"']",e.ele).removeClass("active"),t.stopPropagation()}),e.selected.length||$(".sc-select-content",e.ele).html("<span class='placeholder'>"+e.config.placeholder+"</span>"),$(".sc-select-list",e.ele).css({top:$(".sc-select-hd",e.ele).height()+2})},_renderSingleSelected:function(){var t=this,n=[];for(var r=0;r<t.selected.length;r++)n.push(t.selected[r].key);$(".selected_values",t.ele).val(n.join(",")),this.selected.length?(this.config.format&&(this.selected[0].value=this.config.format(this.selected[0].value)),e.animateInnerHTML($(".sc-select-content",this.ele),this.selected[0].value)):$(".sc-select-content",this.ele).html("<span class='placeholder'>"+this.config.placeholder+"</span>"),this.selected&&this.selected.length&&$(t).trigger("change",{key:this.selected[0].key,value:this.selected[0].value}),this.hideOptions()},_autoDrop:function(e){var t=this.config}}),t}(),Souche.UI.CustomSelect}),define("wannaBuy/leftNav",[],function(){function n(){t.bind()}var e=/^\d+$/,t={bind:function(){$(".custom").submit(t.checkCustomPrice),$(".sc-color a").mousemove(t.colorActive).mouseout(t.colorDeactive)},checkCustomPrice:function(t){var n=$("#minprice").val(),r=$("#maxprice").val();if(!e.test(n)||!e.test(r)){t.preventDefault(),alert("请输入正确的价格！");return}if(parseInt(r)<=parseInt(n)){t.preventDefault(),alert("请输入正确的价格！");return}$("#J_carPrice").val(n+"-"+r)},colorActive:function(){$(this).find("span").removeClass("hidden")},colorDeactive:function(){$(this).find("span").addClass("hidden")}};return{init:n}}),define("wannaBuy/filtByLoan",[],function(){function s(){t=$("#"+e.defaultSubmitBtn),n=$("#"+e.customSubmitBtn)}function o(){s(),i.bind()}var e={defaultSubmitBtn:"span_submit",customSubmitBtn:"span_submit_custom"},t,n,r={validateCustomInputData:function(){var e=new RegExp(/^[\d]+[.]*[\d]*$/),t=$("#repayment_min_input_custom").val(),n=$("#downpayment_max_input_custom").val(),r=$("#downpayment_input_custom").val();if(!e.test(t)&&t!=""||t[0]=="."||t[t.length-1]=="."||!e.test(n)&&n!=""||n[0]=="."||n[n.length-1]=="."||!e.test(r)&&r!=""||r[0]=="."||r[r.length-1]==".")return $(".loan_waring").html("输入正确的数据格式"),!1;$(".loan_waring").html("");var t=$("#repayment_min_input_custom").val(),n=$("#downpayment_max_input_custom").val();if(!t||!n)!t&&!n;else if(parseInt(n)<parseInt(t))return $(".loan_waring").html("月还款数据输入有误"),!1;return!0},validateInputData:function(){var e=new RegExp(/^[\d]+[.]*[\d]*$/),t=$("#downpayment_input").val();return!e.test(t)&&t!=""||t[0]=="."||t[t.length-1]=="."?($(".loan_waring").html("输入正确的数据格式"),!1):($(".loan_waring").html(""),!0)}},i={bind:function(){$(".loan input[type!='checkbox']").change(i.checkDefaultForm),$("#downpayment_input").keyup(i.checkDefaultForm),$("#downpayment_select .sc-select-list a,#repaymentvalue_select .sc-select-list a").click(function(){t.removeClass("disableSubmit")}),$("#downpayment_select .sc-select-list a").click(function(){var e=$(this).attr("data-value");$("#downpayment_select_custom .sc-select-content").html(e),$("#downpayment_select_input_custom").val(e)}),$("#downpayment_input_custom,#repayment_min_input_custom,#downpayment_max_input_custom").keyup(i.checkCustomForm),$(".loan .sc-select-list a[data-value='自定义']").click(function(){$(".loan").addClass("hidden"),$(".loan_custom").removeClass("hidden"),$("#downpayment_input_custom").val($("#downpayment_input").val())}),t.click(i.defaultFormSubmit),n.click(i.customFormSubmit)},checkDefaultForm:function(){t.removeClass("disableSubmit"),r.validateInputData(this)},checkCustomForm:function(){n.removeClass("disableSubmit"),r.validateCustomInputData()},defaultFormSubmit:function(){if(!r.validateInputData(this))return!1;if($(this).hasClass("disableSubmit"))return!1;$(".custom-price #downpayment").val($(".loan #downpayment_input").val().replace(/[\s+]/g,"")),$(".custom-price #downpaymentSelect").val($(".loan #downpayment_select_input").val().replace(/[\s+]/g,"")),$(".loan .custom-price #downpayment").val($(".loan #downpayment_input").val().replace(/[\s+]/g,"")),$(".loan .custom-price #downpaymentSelect").val($(".loan #downpayment_select_input").val().replace(/[\s+]/g,""));if($("#repaymentvalue_select_input").val()!="不限"){var e=$("#repaymentvalue_select_input").val().split("-");if(e.length==2)var t=e[0],n=e[1];if(e.length==1)var n=e[0],t="0";$(".custom-price #minRepayment").val(t),$(".custom-price #maxRepayment").val(n),$(".loan .custom-price #minRepayment").val(t),$(".loan .custom-price #maxRepayment").val(n),$("#repaymentvalue_select_input_min").val(t),$("#repaymentvalue_select_input_max").val(n)}if($("#downpayment_input").val().replace(/[\s+]/g,"")==""){$(".loan_waring").html("请输入首付贷款数据");return}if($("#downpayment_select_input").val().replace(/[\s+]/g,"")==""){$(".loan_waring").html("请输入首付贷款期数");return}$(".loan .loadcustom").submit()},customFormSubmit:function(){if(!r.validateCustomInputData(this))return!1;$(".custom-price #downpayment").val($(".loan_custom #downpayment_input_custom").val().replace(/[\s+]/g,"")),$(".custom-price #downpaymentSelect").val($(".loan_custom #downpayment_select_input_custom").val().replace(/[\s+]/g,"")),$(".custom-price #minRepayment").val($(".loan_custom #repayment_min_input_custom").val().replace(/[\s+]/g,"")),$(".custom-price #maxRepayment").val($(".loan_custom #downpayment_max_input_custom").val().replace(/[\s+]/g,"")),$(".loan_custom .custom-price #downpayment").val($(".loan_custom #downpayment_input_custom").val().replace(/[\s+]/g,"")),$(".loan_custom .custom-price #downpaymentSelect").val($(".loan_custom #downpayment_select_input_custom").val().replace(/[\s+]/g,"")),$(".loan_custom .custom-price #minRepayment").val($(".loan_custom #repayment_min_input_custom").val().replace(/[\s+]/g,"")),$(".loan_custom .custom-price #maxRepayment").val($(".loan_custom #downpayment_max_input_custom").val().replace(/[\s+]/g,""));if($("#downpayment_input_custom").val().replace(/[\s+]/g,"")==""){$(".loan_waring").html("请输入首付贷款数据");return}if($("#downpayment_select_input_custom").val().replace(/[\s+]/g,"")==""){$(".loan_waring").html("请输入首付贷款期数");return}$(".loan_custom .loadcustom").submit()}};return{init:o}}),define("wannaBuy/filterOperate",[],function(){function i(t){$.extend(e,t),n=$(document.body),r.bind()}var e={},t={removeFilter:"historyRecord_content ul li .close"},n,r={bind:function(){$(".choose_save").click(r.saveFilter),n.on("click","."+t.removeFilter,r.deleteFilter)},saveFilter:function(t){var n=this;return Souche.MiniLogin.checkLogin(function(n){$(".historyRecord").removeClass("hidden");var r=$(".choose_save").attr(""),i=$(".choose_save").attr("queryname"),s=$(".choose_save").attr("queryparams"),o="/pages/onsale/sale_car_list.html?"+s,u={queryName:i,queryParams:s,url:o,event:t};$.ajax({url:e.saveSearchResult,type:"POST",data:{queryName:i,queryParams:s},dataType:"json",context:u}).done(function(e){var t=e.id;if(t){var n='<li><a class="content "  href="'+this.url+'" title="'+this.queryName+'">'+this.queryName+'</a><a delid="'+t+'" class="close ">x</a></li>';$(".historyRecord_content ul li").length==0?($(".historyRecord_content ul").append($(n)),$(".historyRecord").removeClass("no-record-yet")):$(n).insertBefore($(".historyRecord_content ul li").eq(0)),$(".choose_saved").removeClass("hidden"),window.setTimeout(function(){$(".choose_saved").addClass("hidden")},2e3),$(".choose_save").addClass("hidden")}else{var r=$(".choose_save ").offset().top,i=$(".choose_save ").offset().left;$(".choose_saved").removeClass("hidden"),window.setTimeout(function(){$(".choose_saved").addClass("hidden")},2e3),$(".choose_save").addClass("hidden")}})}),!1},deleteFilter:function(){var t=$(this).attr("delid"),n=this;return $.ajax({url:e.deleteSearchResult,type:"POST",data:{id:t},context:n}).done(function(e){$(this).parent().remove(),$(".historyRecord_content ul li").length==0&&$(".historyRecord").addClass("no-record-yet")}),!1}};return{init:i}}),define("wannaBuy/carOperate",[],function(){function r(t){$.extend(e,t),n.bind()}var e={},t=/^1[3458][0-9]{9}$/,n={bind:function(){$("#qiugou-form").submit(n.qiugouFormHandler),$("#qiugou-popup .apply_close").click(n.qiugouPopupClose),$("#F_buy_submit").click(n.faseQiugouHandler),$(".carConstrast").on("click",n.addContrast),$("#list-noResult-submit").on("click",n.subscibe)},qiugouFormHandler:function(e){e.preventDefault();if(!t.test($("#qiugou-phone").val())){$(".warning",this).removeClass("hidden");return}Souche.PhoneRegister($("#qiugou-phone").val(),function(){$("#F_buy_top_form").submit()})},qiugouPopupClose:function(){$("#qiugou-popup").addClass("hidden"),$(".qiugou-wrapGrayBg").hide()},faseQiugouHandler:function(e){if($("#F_buybrand").val()==""&&$("#F_buyage").val()=="0-100"&&$("#F_buyprice").val()=="0-100000000")return $("#F_buy_top_form .error_remind").html("请至少选择一个条件").show(),!1;e.preventDefault(),Souche.checkPhoneExist(function(e){e?($("#F_buy_top_form").submit(),$(".historyRecord").removeClass("hidden")):($("#qiugou-popup").removeClass("hidden"),$(".qiugou-wrapGrayBg").show())})},addContrast:function(t){var n=$(this).find("input").attr("carid")||$(this).attr("carid"),r=$(this).find("input").attr("contrastid")||$(this).attr("contrastid"),i;return t.target.tagName!="INPUT"?i=$(this):(i=$(this),$(this).find("input")[0].checked=!$(this).find("input")[0].checked),i.e=t,Souche.MiniLogin.checkLogin(function(){i.find("input")[0].checked||(n?$.ajax({type:"POST",url:e.addContrast,data:{carId:n},dataType:"json",context:i}).done(function(e){if(e.result==2){i.find("input").attr("checked","true"),i.addClass("added");var t=i.clone();t.css({opacity:.8,position:"absolute",top:this.e.pageY+"px",left:this.e.pageX+"px",backgroundColor:"#BCEE68"}).html("加入对比");var n=$(".side-box .contrast-img").offset().left,r=$(".side-box .contrast-img").offset().top;document.body.appendChild(t[0]),t.animate({top:r,left:n},500,function(){t.remove()}),i.find("input").attr("contrastid",e.contrastId);return}if(e.result==-1){i.find(".contrast-waring").html("对比已添加！你不需要继续添加。").removeClass("hidden"),i.find("input").attr("checked","true"),window.setTimeout(function(){i.find(".contrast-waring").addClass("hidden")},2e3);return}if(e.result==1){$(this).find(".contrast-waring").html("对比栏已满！你可以删除不需要的车辆，再继续添加。").removeClass("hidden"),window.setTimeout(function(){i.find(".contrast-waring").addClass("hidden")},2e3);return}$(this).find(".contrast-waring").html("加入对比失败，请刷新页面。").removeClass("hidden"),window.setTimeout(function(){i.find(".contrast-waring").addClass("hidden")},2e3)}):alert("数据不合法"))}),!1},subscibe:function(e){e.preventDefault();if($("#list-noResult-phone").length==0){$("#no-result-form").submit();return}if(!/^1[3458][0-9]{9}$/.test($("#list-noResult-phone").val())){$("#no-result-form .input-error-tip").removeClass("hidden");return}$("#no-result-form .input-error-tip").addClass("hidden"),Souche.PhoneRegister($("#list-noResult-phone").val(),function(){$("#no-result-form").submit()})}};return{init:r}}),define("wannaBuy/new-list-nav",[],function(){function n(){t.bind()}var e=$(".car-wrap"),t={bind:function(){},listViewSiwtch:function(){var t=$(this);if(t.hasClass("active"))return!1;e.removeClass("card-box list-box"),t.addClass("active").siblings(".view-item").removeClass("active"),t.hasClass("list")?e.addClass("list-box"):e.addClass("card-box")}};return{init:n}}),define("wannaBuy/sweetCountdown",[],function(){function e(e){var n=e.endTime-e.nowTime,r=setInterval(function(){n-=1e3,n<=0?(clearInterval(r),e.zeroCallback instanceof Function&&e.zeroCallback()):t(n,e.ctn,e.word)},1e3);t(n,e.ctn,e.word)}function t(e,t,r){e=Math.floor(e/1e3);var i=""+r.pre||"",s=Math.floor(e/3600),o=Math.floor((e-s*3600)/60),u=e-s*3600-o*60;i+='<span class="down-hour">'+s+(r.hour||":")+"</span>",i+='<span class="down-minute">'+n(o)+(r.minute||":")+"</span>",i+='<span class="down-second">'+n(u)+(r.second||":")+"</span>",i+=r.after||"",t.html(i)}function n(e){return e>=10?e:"0"+e}return{mini:e}}),define("souche/util/image-resize",[],function(){return{init:function(e,t,n){$(e).each(function(e,r){r.onload=function(){var e=this.width,i=this.height;i==0||e/i<=t/n?$(this).css({width:"100%",height:"auto"}):($(this).css({height:"100%",width:"auto"}),$(r).css({marginLeft:t/2-$(r).width()/2}),$(window).on("resize",function(){$(r).css({marginLeft:t/2-$(r).width()/2})}))}})}}}),define("wannaBuy/saleCar-list",["souche/dropdown","souche/custom-select","wannaBuy/leftNav","wannaBuy/filtByLoan","wannaBuy/filterOperate","wannaBuy/carOperate","wannaBuy/new-list-nav","wannaBuy/sweetCountdown","souche/util/image-resize"],function(e,t,n,r,i,s,o,u,a){function c(e){$.extend(f,e),l.init(),n.init(),i.init(f),s.init(f)}var f={},l={init:function(){l.initDropdown(),l.initCustomSelect(),r.init(),Souche.UI.Select.init({eles:["F_buybrand","F_buyset",""],type:"car-subdivision",defaultValues:[]}),o.init(),l.initLimitYouhuiCountdown(),l.initGuessLike(),l.autoFitImage()},initDropdown:function(){$("*[data-ui='dropdown']").each(function(t,n){$(n).css({zIndex:1e3-t}),new e(n)})},initCustomSelect:function(){new t("downpayment_select",{placeholder:"请选择",multi:!1}),new t("repaymentvalue_select",{format:function(e){return e!=="自定义"?e+"元以内":e},placeholder:"不限",multi:!1}),new t("downpayment_select_custom",{placeholder:"请选择",multi:!1})},initLimitYouhuiCountdown:function(){$(".time-limit-offer").each(function(e,t){var n=$(t).attr("servertime"),r=$(t).attr("endtime");u.mini({nowTime:Number(n),endTime:Number(r),zeroCallback:function(){$(t).find(".offer-countdown").html("限时优惠已结束")},ctn:$(t).find(".offer-countdown"),word:{pre:"剩余",hour:"时",minute:"分",second:"秒"}})})},initGuessLike:function(){var e=$(".guess-like");e.addClass("loading"),$.ajax({url:f.api_guessCars,success:function(t){function n(){e.removeClass("loading"),e.html(t),e.on("click",".nolike",function(e){var t=this;$(t).closest(".like-box").animate({opacity:0,width:0},500,function(){$(t).closest(".like-box").remove()}),$.ajax({url:f.api_nolikeUrl,data:{carId:$(this).attr("data-id")},dataType:"json",success:function(){}})})}Souche.Util.appear(".guess-like",n),$(window).trigger("scroll")}})},autoFitImage:function(){var e=$(".car-wrap");e.hasClass("card-box")?a.init(".carsItem .img",240,160):e.hasClass("list-box")&&a.init(".carsItem .img",180,120)}};return{init:c}});