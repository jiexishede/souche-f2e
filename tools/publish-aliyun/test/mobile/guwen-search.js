define(["lib/mustache","souche/range-slide"],function(e,n){var t=function(){function t(e){var n=e,t={brands:{},toggleSeries:function(e,t,i){var s=this.brands,a=s[e];if(a&&a[t])this.removeSeries(e,t),$.isEmptyObject(s)&&n.hide();else{if($.isEmptyObject(s)&&n.show(),a=s[e]=s[e]||{},""==t)for(var r in a)this.removeSeries(e,r);else this.removeSeries(e,"");this.addSeries(e,t,i)}},removeSeries:function(e,n){var t=this.brands[e];if(n in t){var i=t[n];i[0].remove(),i[1].removeClass("selected"),delete t[n],$.isEmptyObject(t)&&delete this.brands[e]}},addSeries:function(e,t,i){var s=this.brands,a=s[e]=s[e]||{};a[t]=i,n.append(i[0]),i[1].addClass("selected")}};return t}return{init:function(){function i(e){h.push(l),e=e||l+1,document.body.scrollTop=0,3==e?$("#submit-btn").text("完成定制").show():4==e?$("#submit-btn").hide():$("#submit-btn").text("下一步").show();var n=u[l-1],t=u[e-1];t.css({left:"100%"}).show(),n.animate({left:"-100%"},function(){n.hide()}),t.animate({left:"0"}),l=e}function s(){document.body.scrollTop=0;var e=h.pop();if(0==e)return void(-1!=document.referrer.indexOf("souche")?history.back():window.location.href="index.html");3==e?$(".next-btn").text("完成定制").show():4==e?$(".next-btn").hide():$(".next-btn").text("下一步").show();var n=u[l-1],t=u[e-1];t.css({left:"-100%"}).show(),n.animate({left:"100%"},function(){n.hide()}),t.animate({left:"0"}),l=e}function a(){b.removeClass("hidden"),BrandAjaxUtil.getRecomBrands(function(n){for(var t,s=n.brands,a=($("#brand-icons-container"),'<div class="icon-group">'),r="</div>",o="",c=s.length,d=Math.ceil(c/4),l=0;d>l;l++){t=Math.min(c-4*l,4);for(var h=0;t>h;h++)o+=e.render(v,{brand:s[4*l+h]});$("#brand-icons-container").append(a+o+r),o=""}b.addClass("hidden"),i()})}function r(){var e=c.getData(),n=d.brands,t=e.min.value.replace("万",""),s=e.max.value.replace("万","");"无限"==s&&(s=1e4);var a="",r="";for(var o in n)for(var l in n[o])""==l?a+=","+o:r+=","+l;a=a.substring(1),r=r.substring(1),i(),$.ajax({url:contextPath+"/mobile/carCustomAction/saveBuyInfo.json",dataType:"json",data:{brands:a,series:r,year:m,minPrice:t,maxPrice:s},success:function(){window.location.href=contextPath+"/mobile/carcustom.html"},error:function(){alert("error")}})}function o(){$(".cover-layer").removeClass("hidden");var e=$(window).width(),n=(e-300)/2;$("#phone-popup").css({left:n}).removeClass("hidden")}var c=new n({ele:".sc-rangeslider",steps:["0万","3万","5万","6万","7万","8万","9万","10万","12万","14万","15万","16万","18万","20万","22万","24万","25万","30万","35万","40万","50万","60万","70万","100万","无限"],min:"8万",max:"20万",tpl:"%"}),d=t($(".selected-brand")),d=t($(".selected-brand")),l=1,h=[];h.push(0);var u=[$("#page-1"),$("#page-2"),$("#page-3"),$("#page-4")],f=!1,v=$("#tpl_brand").text();$("#tpl_series").text(),$("#page-2 .next-btn").click(function(){i()}),$(".back-icon").click(function(){s()}),$(".selected-brand").on("click",".sb-item",function(){var e=$(this),n=e.attr("brand-code"),t=e.attr("series-code");d.toggleSeries(n,t)});var b=$(".loading-cover-layer");$("#brand-icons-container").on("click",".icon-item",function(){var e=$(this),n=e.attr("data-code"),t=e.find(".brand-name").text(),i='<div class="sb-item" brand-code='+n+' series-code=><span class="text">'+t+'</span><i class="close-icon"></i></div>';d.toggleSeries(n,"",[$(i),e.find(".brand-name")])});var m="";$(".year-item").click(function(){$(".year-item .text").removeClass("selected"),$(this).find(".text").addClass("selected"),m=$(this).attr("data-code")}),$("#submit-btn").click(function(){return 3!=l?void(f||1!=l?i():(a(),f=!0)):void SM.checkPhoneExist(function(e){e?r():o()})});var p=/^1[3458][0-9]{9}$/;$("#phone-form").submit(function(e){var n=$("#phone-num").val();e.preventDefault(),p.test(n)?SM.PhoneRegister(n,function(){r()}):alert("请输入正确的手机号码")}),$(".search-icon").click(function(){var e=$(this).siblings(".search-icon-2");$(this).parent().siblings(".search-box").show(),$(this).hide(),e.show()}),$(".search-icon-2").click(function(){var e=$(this).siblings(".search-icon");$(this).parent().siblings(".search-box").hide(),$(this).hide(),e.show()}),$(".cancel-icon").click(function(){var e=$(this).siblings("input[name=keyword]");e.val(""),e.focus()}),$(".search-form").submit(function(e){var n=$(this).find("input[name=keyword]");""==n.val().trim()&&(n.val(""),e.preventDefault())}),$(".search-btn").click(function(){var e=$(this).siblings(".input").find("input[name=keyword]");""==e.val().trim()?e.val(""):e.parent().submit()});var g=1;$ellipsis=$("#page-4 .ellipsis"),setInterval(function(){for(var e="",n=0;g>n;n++)e+=".";$ellipsis.text(e),3==g?g=1:g++},500)}}}();return t});